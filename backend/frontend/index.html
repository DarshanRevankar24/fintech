<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Portfolio Explainer</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css?v=2">
    <link rel="stylesheet" href="chat_style.css?v=2">
</head>

<body>
    <div class="background-orbs">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="auth-modal glass-panel">
        <h2 class="gradient-text" id="auth-title">Log In to AI Portfolio</h2>
        <p id="auth-subtitle">Analyze, save, and manage your investments.</p>

        <form id="auth-form">
            <div class="form-group" id="name-group" style="display: none;">
                <label>Full Name</label>
                <input type="text" id="auth-fullname" class="table-input" placeholder="e.g. Satoshi Nakamoto">
            </div>
            <div class="form-group" id="email-group" style="display: none;">
                <label>Email Address</label>
                <input type="email" id="auth-email" class="table-input" placeholder="satoshi@bitcoin.org">
            </div>
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="auth-username" class="table-input" required placeholder="Choose a username">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="auth-password" class="table-input" required placeholder="••••••••">
            </div>

            <!-- Financial Profile Fields (Only shown during registration) -->
            <div id="register-profile-section"
                style="display: none; margin-top: 1rem; border-top: 1px solid var(--panel-border); padding-top: 1rem;">
                <h4 style="margin-bottom: 1rem;"><i class="fa-solid fa-address-card"></i> Optional: Financial Profile
                </h4>
                <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem;">This helps the AI give
                    you hyper-personalized advice.</p>
                <div class="settings-grid" style="grid-template-columns: 1fr 1fr;">
                    <div class="setting-item">
                        <label>Age</label>
                        <input type="number" id="profile-age" class="table-input" placeholder="e.g. 35" min="18">
                    </div>
                    <div class="setting-item">
                        <label>Profession</label>
                        <select id="profile-profession" class="table-input"
                            style="width: 100%; border-radius: 6px; padding: 0.5rem; background: rgba(0,0,0,0.05); border: 1px solid var(--panel-border); color: var(--text-primary);">
                            <option value="Salaried">Salaried</option>
                            <option value="Business Owner">Business Owner</option>
                            <option value="Freelancer">Freelancer</option>
                            <option value="Student">Student</option>
                            <option value="Retired">Retired</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>Annual Income</label>
                        <select id="profile-income" class="table-input"
                            style="width: 100%; border-radius: 6px; padding: 0.5rem; background: rgba(0,0,0,0.05); border: 1px solid var(--panel-border); color: var(--text-primary);">
                            <option value="<5L">&lt;5L</option>
                            <option value="5-10L" selected>5–10L</option>
                            <option value="10-20L">10–20L</option>
                            <option value="20L+">20L+</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>Investment Experience</label>
                        <select id="profile-experience" class="table-input"
                            style="width: 100%; border-radius: 6px; padding: 0.5rem; background: rgba(0,0,0,0.05); border: 1px solid var(--panel-border); color: var(--text-primary);">
                            <option value="Beginner">Beginner</option>
                            <option value="Intermediate">Intermediate</option>
                            <option value="Advanced">Advanced</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>Risk Appetite</label>
                        <select id="profile-risk" class="table-input"
                            style="width: 100%; border-radius: 6px; padding: 0.5rem; background: rgba(0,0,0,0.05); border: 1px solid var(--panel-border); color: var(--text-primary);">
                            <option value="Low">Low</option>
                            <option value="Moderate" selected>Moderate</option>
                            <option value="High">High</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>Investment Horizon</label>
                        <select id="profile-horizon" class="table-input"
                            style="width: 100%; border-radius: 6px; padding: 0.5rem; background: rgba(0,0,0,0.05); border: 1px solid var(--panel-border); color: var(--text-primary);">
                            <option value="Short <3 yrs">Short &lt;3 yrs</option>
                            <option value="Medium 3-7 yrs" selected>Medium 3–7 yrs</option>
                            <option value="Long >7 yrs">Long &gt;7 yrs</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>Dependents</label>
                        <select id="profile-dependents" class="table-input"
                            style="width: 100%; border-radius: 6px; padding: 0.5rem; background: rgba(0,0,0,0.05); border: 1px solid var(--panel-border); color: var(--text-primary);">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3+">3+</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>Primary Goal</label>
                        <select id="profile-goal" class="table-input"
                            style="width: 100%; border-radius: 6px; padding: 0.5rem; background: rgba(0,0,0,0.05); border: 1px solid var(--panel-border); color: var(--text-primary);">
                            <option value="Wealth Growth">Wealth Growth</option>
                            <option value="Retirement">Retirement</option>
                            <option value="Passive Income">Passive Income</option>
                            <option value="Capital Protection">Capital Protection</option>
                        </select>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-action" id="auth-submit-btn">Log In</button>
        </form>

        <p class="auth-switch">
            <span id="auth-switch-text">Don't have an account?</span>
            <a href="#" id="auth-switch-link">Register here</a>
        </p>
    </div>

    <!-- Main App Container (Hidden until logged in) -->
    <div class="container hidden" id="app-container">
        <header>
            <div class="header-top" style="display: flex; justify-content: space-between; align-items: center;">
                <h1 class="gradient-text"><i class="fa-solid fa-chart-line"></i> AI Portfolio Analyzer</h1>
                <div class="user-badge" style="display: flex; gap: 1rem; align-items: center;">
                    <span id="welcome-name" style="font-weight: 600;"></span>
                    <button id="logout-btn" class="btn btn-outline btn-sm"><i
                            class="fa-solid fa-arrow-right-from-bracket"></i> Logout</button>
                </div>
            </div>
            <p>Enter your portfolio details to get a real-time, personalized financial explanation.</p>
        </header>

        <!-- Upload Section -->
        <main id="upload-section" class="glass-panel">
            <div class="manual-entry-area" id="manual-entry">
                <h3><i class="fa-solid fa-pen-to-square"></i> Enter Portfolio Holdings</h3>
                <p>Add your stock tickers, shares, and purchase details below. We'll fetch real-time prices
                    automatically.</p>

                <div class="table-container">
                    <table id="portfolio-table">
                        <thead>
                            <tr>
                                <th>Ticker Symbol</th>
                                <th>Shares Owned</th>
                                <th>Purchase Price ($)</th>
                                <th>Purchase Date</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="portfolio-body">
                            <!-- Rows will be added here dynamically -->
                        </tbody>
                    </table>
                </div>

                <button class="btn btn-outline" id="add-row-btn" style="margin-top: 1rem;">
                    <i class="fa-solid fa-plus"></i> Add Holding
                </button>
            </div>

            <div class="settings-grid">
                <div class="setting-item">
                    <label for="user-level"><i class="fa-solid fa-user-graduate"></i> Expertise Level</label>
                    <select id="user-level">
                        <option value="beginner" selected>Beginner - Keep it simple</option>
                        <option value="intermediate">Intermediate - Standard terms</option>
                        <option value="expert">Expert - Data & Metrics</option>
                    </select>
                </div>

                <div class="setting-item checkbox-wrap">
                    <label class="toggle">
                        <input type="checkbox" id="include-tax" checked>
                        <span class="slider"></span>
                    </label>
                    <span class="toggle-label"><i class="fa-solid fa-file-invoice-dollar"></i> Include Tax
                        Analysis</span>
                </div>

                <div class="setting-item checkbox-wrap">
                    <label class="toggle">
                        <input type="checkbox" id="include-rebalance" checked>
                        <span class="slider"></span>
                    </label>
                    <span class="toggle-label"><i class="fa-solid fa-scale-balanced"></i> Suggest Rebalancing</span>
                </div>
            </div>

            <button id="analyze-btn" class="btn btn-action" disabled>
                <i class="fa-solid fa-wand-magic-sparkles"></i> Analyze Portfolio
            </button>
        </main>

        <!-- Loading Section -->
        <div id="loading-section" class="hidden glass-panel loading-panel">
            <div class="spinner"></div>
            <h3 class="gradient-text" id="loading-text">Fetching live prices...</h3>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
        </div>

        <!-- Dashboard / Results Section -->
        <section id="result-section" class="hidden">
            <!-- Suitability & Alignment -->
            <div class="stats-grid" style="margin-bottom: 1.5rem">
                <div class="stat-card glass-panel" id="suitability-card"
                    style="border-left: 4px solid var(--panel-border);">
                    <div class="stat-icon"><i class="fa-solid fa-bullseye"></i></div>
                    <div class="stat-info">
                        <p>Suitability Score</p>
                        <h2 id="suitability-score" style="margin-top:0.2rem">--/100</h2>
                        <span id="suitability-level"
                            style="font-size: 0.9rem; font-weight: 500; display: inline-block; margin-top:0.3rem; padding: 0.2rem 0.5rem; border-radius: 4px; background: rgba(0,0,0,0.05);">--</span>
                    </div>
                </div>
                <div class="stat-card glass-panel">
                    <div class="stat-icon"><i class="fa-solid fa-user-clock"></i></div>
                    <div class="stat-info">
                        <p>Life Stage Profile</p>
                        <h3 id="life-stage" style="margin-top:0.5rem; font-size:1.1rem; color:var(--text)">--</h3>
                    </div>
                </div>
                <div class="stat-card glass-panel" style="grid-column: span 1.5;">
                    <div class="stat-icon"><i class="fa-solid fa-triangle-exclamation"></i></div>
                    <div class="stat-info">
                        <p>Alignment Indicators & Warnings</p>
                        <ul id="suitability-breakdown"
                            style="margin-top:0.5rem; font-size:0.9rem; padding-left:1rem; color:var(--text-secondary)">
                            <li>No warnings.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Top Stats -->
            <div class="stats-grid">
                <div class="stat-card glass-panel">
                    <div class="stat-icon"><i class="fa-solid fa-wallet"></i></div>
                    <div class="stat-info">
                        <p>Total Value (Live)</p>
                        <h2 class="gradient-text" id="total-value">$0.00</h2>
                    </div>
                </div>
                <div class="stat-card glass-panel">
                    <div class="stat-icon"><i class="fa-solid fa-arrow-trend-up"></i></div>
                    <div class="stat-info">
                        <p>Unrealized Gain</p>
                        <h2 id="total-gain">$0.00 (0.0%)</h2>
                    </div>
                </div>
                <div class="stat-card glass-panel">
                    <div class="stat-icon"><i class="fa-solid fa-crown"></i></div>
                    <div class="stat-info">
                        <p>Top Position</p>
                        <h2 id="top-position">AAPL (0%)</h2>
                    </div>
                </div>
            </div>

            <!-- Analysis & Chart Row -->
            <div class="main-content-grid">
                <div class="explanation-card glass-panel">
                    <h3><i class="fa-solid fa-robot"></i> AI Assessment</h3>
                    <div id="ai-explanation" class="markdown-body">
                        <!-- AI Explanation injected here -->
                    </div>
                </div>

                <div class="chart-card glass-panel">
                    <h3><i class="fa-solid fa-chart-pie"></i> Sector Allocation</h3>
                    <div class="chart-container">
                        <canvas id="sectorChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Pros/Cons Row -->
            <div class="pros-cons-grid">
                <div class="glass-panel strengths">
                    <h3><i class="fa-regular fa-thumbs-up"></i> Key Strengths</h3>
                    <ul id="strengths-list"></ul>
                </div>
                <div class="glass-panel risks">
                    <h3><i class="fa-solid fa-triangle-exclamation"></i> Risks & Concerns</h3>
                    <ul id="risks-list"></ul>
                </div>
            </div>

            <!-- Tax Impact & Rebalancing -->
            <div class="bottom-grid">
                <div class="glass-panel tax-panel hidden" id="tax-panel">
                    <h3><i class="fa-solid fa-money-bill-transfer"></i> Estimated Tax Impact</h3>
                    <div class="table-container">
                        <table id="tax-table">
                            <thead>
                                <tr>
                                    <th>Asset</th>
                                    <th>Gain/Loss</th>
                                    <th>Type</th>
                                    <th>Est. Tax</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div class="glass-panel rebalance-panel hidden" id="rebalance-panel">
                    <h3><i class="fa-solid fa-shuffle"></i> Rebalancing Ideas</h3>
                    <div id="rebalance-list" class="rebalance-list">
                        <!-- Rebalancing cards injected here -->
                    </div>
                </div>
            </div>

            <div class="action-row">
                <button class="btn btn-outline" onclick="window.location.reload()"><i
                        class="fa-solid fa-rotate-right"></i> Analyze Another Portfolio</button>
            </div>
        </section>

    </div>

    <!-- Floating Edit Profile Button -->
    <button id="floating-edit-profile-btn" class="btn btn-action"
        style="display: none; position: fixed; bottom: 20px; left: 20px; z-index: 999; width: auto; padding: 0.75rem 1.5rem; border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
        <i class="fa-solid fa-user-pen"></i> Edit Profile
    </button>

    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal" class="auth-modal glass-panel"
        style="display: none; max-width: 600px; text-align: left; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 class="gradient-text"><i class="fa-solid fa-address-card"></i> Edit Financial Profile</h3>
            <button id="close-edit-profile-btn"
                style="background: transparent; border: none; color: var(--text-primary); font-size: 1.2rem; cursor: pointer;"><i
                    class="fa-solid fa-xmark"></i></button>
        </div>
        <div id="edit-profile-grid" class="settings-grid"
            style="grid-template-columns: 1fr 1fr; margin-bottom: 1.5rem;">
            <!-- Fields dynamically cloned here -->
        </div>
        <button id="save-edit-profile-btn" class="btn btn-action" style="margin-top: 0;">Save &amp; Re-preview</button>
    </div>

    <!-- Floating Chatbot -->
    <div class="chatbot-container">
        <!-- Toggle Button -->
        <div class="chatbot-toggle" id="chatbot-toggle">
            <i class="fa-solid fa-comment-dots"></i>
        </div>

        <!-- Chat Window -->
        <div class="chatbot-window" id="chatbot-window">
            <div class="chatbot-header">
                <h3><i class="fa-solid fa-robot"></i> AI Financial Assistant</h3>
                <button class="close-chat" id="close-chat"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="chatbot-messages" id="chatbot-messages">
                <div class="chat-message bot">
                    <p>Hello! I am your AI Financial Assistant. Ask me questions about your portfolio, the market, or
                        specific stocks.</p>
                </div>
            </div>
            <div class="chatbot-input">
                <input type="text" id="chat-input-field" placeholder="Ask about Apple earnings..." autocomplete="off">
                <button id="send-chat-btn"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>